"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[320],{285:(e,t,r)=>{r.d(t,{$:()=>c});var s=r(5155),a=r(2115),i=r(9708),o=r(2085),n=r(9434);let l=(0,o.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",premium:"bg-gradient-to-r from-yellow-400 via-orange-500 to-red-500 text-white hover:shadow-lg transition-shadow"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,t)=>{let{className:r,variant:a,size:o,asChild:c=!1,...u}=e,d=c?i.DX:"button";return(0,s.jsx)(d,{className:(0,n.cn)(l({variant:a,size:o,className:r})),ref:t,...u})});c.displayName="Button"},1320:(e,t,r)=>{r.d(t,{AuthProvider:()=>k,a:()=>Y,A:()=>I});var s=r(5155),a=r(2115),i=r(4903),o=r(6104),n=r(3957),l=r(5317),c=r(3308);let u=c.Ik({fitnessGoals:c.Yj().describe("The user’s primary fitness goals, e.g., weight lifting, cardio, weight loss."),gender:c.Yj().describe("The user's gender."),age:c.ai().describe("The user’s age."),weight:c.ai().describe("The user’s weight in kilograms."),activityLevel:c.Yj().describe("The user's weekly activity level."),diet:c.Yj().describe("The user's dietary preference (e.g., Balanced, Vegan, Keto)."),sleepQuality:c.Yj().describe("The user's self-reported sleep quality."),healthConcerns:c.YO(c.Yj()).optional().describe("A list of specific health concerns the user has."),otherCriteria:c.Yj().optional().describe("Any other relevant criteria from the user, like allergies."),budget:c.Yj().optional().describe("The user specified budget for supplements."),race:c.Yj().describe("The user’s race or ethnicity.")}),d=c.Ik({supplementName:c.Yj().describe("The name of the supplement."),brand:c.Yj().describe("The brand of the supplement."),price:c.Yj().describe("The price of the supplement."),whereToOrder:c.Yj().describe("Where to order the supplement from."),userReviewsSummary:c.Yj().describe("A summary of user reviews for the supplement."),scientificDataSummary:c.Yj().describe("A summary of scientific data supporting the supplement."),imageUrl:c.Yj().optional().describe("A dynamically generated image URL for the supplement."),asin:c.Yj().optional().describe("A fake but realistic-looking Amazon Standard Identification Number (ASIN).")}),p=c.Ik({suggestions:c.YO(d).describe("A list of supplement suggestions."),dailySchedule:c.Yj().describe("A daily schedule of when to take the supplements."),additionalNotes:c.Yj().optional().describe("Any additional notes or considerations for the user.")});async function h(e,t){try{let r=(0,o.ru)(),s=JSON.parse(t),a=c.Ik({input:u,output:p}).safeParse(s);if(!a.success)return void console.error("Invalid plan data provided, cannot save:",a.error.format());let i=(0,l.rJ)(r,"users/".concat(e,"/plans"));await (0,l.gS)(i,{...a.data,createdAt:(0,l.O5)()})}catch(t){console.error("Failed to save initial plan for user ".concat(e,":"),t)}}async function g(e,t){console.log("\uD83D\uDD0D getOrCreateUserProfile called for user:",e.email);let r=(0,o.ru)(),s=(0,l.H9)(r,"users",e.uid);try{var a,i,n,c;console.log("\uD83D\uDD0D Checking if user document exists...");let r=await (0,l.x7)(s);if(r.exists()){console.log("✅ User document exists, loading profile...");let e=r.data(),t=e.subscription,s=!1;(null==t?void 0:t.status)==="active"&&t.endDate&&(s=((null==(i=t.endDate)?void 0:i.toDate)?t.endDate.toDate():new Date(t.endDate))>new Date);let o={email:e.email,displayName:e.displayName,photoURL:e.photoURL,createdAt:(null==(a=e.createdAt)?void 0:a.toDate().toISOString())||new Date().toISOString(),isAdmin:null!=(n=e.isAdmin)&&n,isPremium:s,subscription:t};return{success:!0,profile:o}}{console.log("\uD83D\uDD28 User document doesn't exist, creating new profile...");let r=e.displayName||(null==(c=e.email)?void 0:c.split("@")[0])||"User",a=e.photoURL||"https://ui-avatars.com/api/?name=".concat(encodeURIComponent(r),"&background=random&color=fff"),i={email:e.email,displayName:r,photoURL:a,createdAt:(0,l.O5)(),isAdmin:!1};console.log("\uD83D\uDD28 Writing new user profile to Firestore...",i),await (0,l.BN)(s,i),console.log("✅ User profile created successfully"),t&&(console.log("\uD83D\uDD28 Saving initial plan for user..."),await h(e.uid,t));let o={...i,createdAt:new Date().toISOString(),isPremium:!1};return console.log("✅ New user profile created and returned:",o),{success:!0,profile:o}}}catch(e){return console.error("❌ Error in getOrCreateUserProfile:",e),{success:!1,error:e.message}}}c.Ik({userId:c.Yj().describe("The unique identifier of the user."),message:c.Yj().describe("The user message to the chatbot."),chatHistory:c.YO(c.Ik({role:c.k5(["user","assistant"]),content:c.Yj()})).optional().describe("The chat history between the user and the chatbot."),recommendationContext:c.Ik({input:u,output:p}).optional().describe("The context of a previously generated supplement recommendation.")}),c.Ik({response:c.Yj().describe("The chatbot response to the user message."),recommendation:p.optional().describe("A new supplement recommendation, if one was generated."),recommendationInput:u.optional().describe("The input that generated the new recommendation.")}),c.Ik({supplementName:c.Yj().describe("The name of the supplement.")}),c.Ik({imageUrl:c.Yj().describe("The data URI of the generated supplement image. Format: 'data:image/png;base64,<encoded_data>'")}),c.Ik({supplements:c.YO(c.Ik({name:c.Yj().describe("The name of the supplement."),dosage:c.Yj().describe("The dosage of the supplement (e.g., 500mg)."),timing:c.Yj().describe("The ideal timing for taking the supplement (e.g., with breakfast, before workout)."),duration:c.Yj().describe("The duration for taking the supplement (e.g., 4 weeks, 3 months)."),notes:c.Yj().optional().describe("Any additional notes or instructions for the supplement.")})).describe("An array of supplement objects, each containing name, dosage, timing, duration, and optional notes."),userLifestyle:c.Yj().describe("Description of the user lifestyle")}),c.Ik({schedule:c.Yj().describe("A personalized daily schedule detailing when and how to take each supplement, considering optimal timing and duration.")});var f=r(7481),m=r(285),b=r(1154),v=r(5695);let y=(0,a.createContext)(void 0),w=new i.HF;w.setCustomParameters({prompt:"select_account"});let A=["/login","/signup","/forgot-password"],S=["/","/advisor","/subscribe","/subscribe/checkout","/cart"],T="/verify-email",j=e=>A.some(t=>e.startsWith(t)),k=e=>{let{children:t}=e,[r,l]=(0,a.useState)(null),[c,u]=(0,a.useState)(null),[d,p]=(0,a.useState)(!0),[h,m]=(0,a.useState)(!1),{toast:b}=(0,f.dj)(),A=(0,v.useRouter)(),k=(0,v.usePathname)(),I=(0,v.useSearchParams)(),Y=(0,a.useCallback)(async e=>{if(console.log("\uD83D\uDD04 Auth state changed:",e?"User: ".concat(e.email,", Verified: ").concat(e.emailVerified):"No user"),p(!0),e){console.log("\uD83D\uDD04 Attempting to get/create user profile for:",e.email);let{success:t,profile:r,error:s}=await g(e);console.log("\uD83D\uDD04 Profile result:",{success:t,profile:r,error:s}),t&&r?(l(e),u(r),console.log("✅ User profile loaded successfully")):(console.error("❌ Profile fetch/create failed:",s),b({variant:"destructive",title:"Authentication Error",description:"There was a problem loading your user profile. Please try logging in again."}),await (0,n.r)(),l(null),u(null))}else l(null),u(null);p(!1)},[b]);(0,a.useEffect)(()=>{console.log("\uD83D\uDE80 Setting up Firebase Auth listener...");let e=(0,o.Cy)();console.log("\uD83D\uDE80 Firebase Auth instance:",e);let t=(0,i.hg)(e,e=>{console.log("\uD83D\uDD25 onAuthStateChanged triggered with user:",e?e.email:"null"),Y(e)});return()=>{console.log("\uD83D\uDE80 Cleaning up Firebase Auth listener"),t()}},[Y]),(0,a.useEffect)(()=>{var e;if(d)return;let t=null!=(e=null==r?void 0:r.emailVerified)&&e;if(r)if(t||k===T){if(t&&(j(k)||k===T)){let e=I.get("redirect")||"/tracker";A.push(e)}}else A.push(T);else j(k)||(e=>S.some(t=>e.startsWith(t))||"/"===e)(k)||k===T||A.push("/login?redirect=".concat(k))},[r,d,k,A,I]);let x=(0,a.useCallback)(async()=>{console.log("\uD83D\uDD0D Refreshing auth status...");let e=(0,o.Cy)().currentUser;e?(console.log("\uD83D\uDD0D Current user found, reloading..."),await e.reload(),await Y(e)):(console.log("\uD83D\uDD0D No current user found during refresh"),await Y(null))},[Y]),C=async e=>{if(h)return;m(!0);let t=(0,o.Cy)();try{await (0,i.df)(t,w)}catch(e){"auth/popup-closed-by-user"!==e.code&&"auth/cancelled-popup-request"!==e.code&&b({variant:"destructive",title:"Google Sign-in Failed",description:"An unexpected error occurred: ".concat(e.message)})}finally{m(!1)}};return(0,s.jsx)(y.Provider,{value:{user:r,profile:c,loading:d,isAuthInProgress:h,refreshAuthStatus:x,googleSignIn:C},children:t})},I=()=>{let e=(0,a.useContext)(y);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e};function Y(e){let{initialPlanJson:t}=e,{googleSignIn:r,isAuthInProgress:a}=I();return(0,s.jsxs)(m.$,{variant:"outline",className:"w-full",type:"button",disabled:a,onClick:()=>{r(t).catch(e=>{})},"data-testid":"google-button",children:[a?(0,s.jsx)(b.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)("svg",{className:"mr-2 h-4 w-4","aria-hidden":"true",focusable:"false","data-prefix":"fab","data-icon":"google",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 488 512",children:(0,s.jsx)("path",{fill:"currentColor",d:"M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 126 21.2 172.9 65.6l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2 0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"})}),a?"Please wait...":"Continue with Google"]})}},3957:(e,t,r)=>{r.d(t,{r:()=>a});var s=r(4477);let a=(0,s.createServerReference)("0033b0c20bbdf4f621e168125c011a3c0c16a42dbb",s.callServer,void 0,s.findSourceMapURL,"logout")},6104:(e,t,r)=>{let s;r.d(t,{Cy:()=>l,ru:()=>c});var a=r(3915),i=r(4903),o=r(5317);s=0===(0,a.Dk)().length?(0,a.Wp)({apiKey:"AIzaSyD7Z1SD_6yhEueIUE_NRAh-9kJHjzcwYaE",authDomain:"nutriwise-ai-3fmvs.firebaseapp.com",projectId:"nutriwise-ai-3fmvs",storageBucket:"nutriwise-ai-3fmvs.firebasestorage.app",messagingSenderId:"336578713643",appId:"1:336578713643:web:704650262eaac23288726e"}):(0,a.Sx)();let n=(0,o.aU)(s),l=()=>(0,i.xI)(s),c=()=>n},7481:(e,t,r)=>{r.d(t,{dj:()=>d});var s=r(2115);let a=0,i=new Map,o=e=>{if(i.has(e))return;let t=setTimeout(()=>{i.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);i.set(e,t)},n=[],l={toasts:[]};function c(e){l=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?o(r):e.toasts.forEach(e=>{o(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(l,e),n.forEach(e=>{e(l)})}function u(e){let{...t}=e,r=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>c({type:"DISMISS_TOAST",toastId:r});return c({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||s()}}}),{id:r,dismiss:s,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function d(){let[e,t]=s.useState(l);return s.useEffect(()=>(n.push(t),()=>{let e=n.indexOf(t);e>-1&&n.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},9434:(e,t,r)=>{r.d(t,{cn:()=>i});var s=r(2596),a=r(9688);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.QP)((0,s.$)(t))}}}]);