"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[568],{1394:(e,r,s)=>{s.d(r,{BK:()=>o,eu:()=>i,q5:()=>d});var t=s(5155),a=s(2115),l=s(4011),n=s(9434);let i=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(l.bL,{ref:r,className:(0,n.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...a})});i.displayName=l.bL.displayName;let o=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(l._V,{ref:r,className:(0,n.cn)("aspect-square h-full w-full",s),...a})});o.displayName=l._V.displayName;let d=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(l.H4,{ref:r,className:(0,n.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...a})});d.displayName=l.H4.displayName},2523:(e,r,s)=>{s.d(r,{p:()=>n});var t=s(5155),a=s(2115),l=s(9434);let n=a.forwardRef((e,r)=>{let{className:s,type:a,...n}=e;return(0,t.jsx)("input",{type:a,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:r,...n})});n.displayName="Input"},6424:(e,r,s)=>{s.d(r,{F:()=>i});var t=s(5155),a=s(2115),l=s(7655),n=s(9434);let i=a.forwardRef((e,r)=>{let{className:s,children:a,...i}=e;return(0,t.jsxs)(l.bL,{ref:r,className:(0,n.cn)("relative overflow-hidden",s),...i,children:[(0,t.jsx)(l.LM,{className:"h-full w-full rounded-[inherit]",children:a}),(0,t.jsx)(o,{}),(0,t.jsx)(l.OK,{})]})});i.displayName=l.bL.displayName;let o=a.forwardRef((e,r)=>{let{className:s,orientation:a="vertical",...i}=e;return(0,t.jsx)(l.VM,{ref:r,orientation:a,className:(0,n.cn)("flex touch-none select-none transition-colors","vertical"===a&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...i,children:(0,t.jsx)(l.lr,{className:"relative flex-1 rounded-full bg-border"})})});o.displayName=l.VM.displayName},6568:(e,r,s)=>{s.r(r),s.d(r,{default:()=>v});var t=s(5155),a=s(2115),l=s(8382),n=s(285),i=s(2523),o=s(6424),d=s(1366),c=s(9946);let u=(0,c.A)("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]),f=(0,c.A)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var p=s(1154),h=s(2486),m=s(1394),x=s(4477);let j=(0,x.createServerReference)("40aadaaccd0cf3249ef5f2805ef6eee103a9e86387",x.callServer,void 0,x.findSourceMapURL,"chatbotResponseAction");var y=s(7481),b=s(9434),g=s(4031);function v(){let{isChatOpen:e,setChatOpen:r,initialPrompt:s,setInitialPrompt:c,recommendationContext:x,setAdvisorResults:v}=(0,g.U)(),[N,w]=(0,a.useState)([]),[k,A]=(0,a.useState)(""),[C,M]=(0,a.useState)(!1),R=(0,a.useRef)(null),{toast:q}=(0,y.dj)();(0,a.useEffect)(()=>{0===N.length&&w([{role:"assistant",content:"Hello! I'm your AI supplement expert. How can I help you today? I can answer questions or create a new supplement plan for you."}])},[N.length]),(0,a.useEffect)(()=>{e&&s&&(A(s),c(""))},[e,s,c]),(0,a.useEffect)(()=>{var e;let r=null==(e=R.current)?void 0:e.querySelector("[data-radix-scroll-area-viewport]");r&&setTimeout(()=>{r.scrollTo({top:r.scrollHeight,behavior:"smooth"})},0)},[N]);let I=async e=>{if(e.preventDefault(),!k.trim()||C)return;let s={role:"user",content:k};w(e=>[...e,s]),A(""),M(!0);try{let e;x&&(e={...x,output:{...x.output,suggestions:x.output.suggestions.map(e=>{let{imageUrl:r,...s}=e;return s})}});let s={userId:"anonymous",message:k,chatHistory:N,recommendationContext:e},t=await j(s);t.recommendation&&t.recommendationInput&&(v(t.recommendation,t.recommendationInput),r(!1));let a={role:"assistant",content:t.response};w(e=>[...e,a])}catch(e){q({variant:"destructive",title:"Chat Error",description:e.message||"An unexpected error occurred in the chat."}),w(e=>e.slice(0,-1))}finally{M(!1)}};return(0,t.jsxs)(l.cj,{open:e,onOpenChange:r,children:[(0,t.jsx)(l.CG,{asChild:!0,children:(0,t.jsxs)(n.$,{className:"fixed bottom-4 right-4 h-16 w-16 rounded-full shadow-lg",size:"icon",children:[(0,t.jsx)(d.A,{className:"h-8 w-8"}),(0,t.jsx)("span",{className:"sr-only",children:"Open Chat"})]})}),(0,t.jsxs)(l.h,{className:"flex flex-col",children:[(0,t.jsx)(l.Fm,{children:(0,t.jsx)(l.qp,{className:"font-headline",children:"Chat with NutriStack AI"})}),(0,t.jsx)(o.F,{className:"flex-grow my-4 pr-4",ref:R,children:(0,t.jsxs)("div",{className:"space-y-4",children:[N.map((e,r)=>(0,t.jsxs)("div",{className:(0,b.cn)("flex items-start gap-3","user"===e.role?"justify-end":"justify-start"),children:["assistant"===e.role&&(0,t.jsx)(m.eu,{children:(0,t.jsx)(m.q5,{children:(0,t.jsx)(u,{})})}),(0,t.jsx)("div",{className:(0,b.cn)("p-3 rounded-lg max-w-xs","user"===e.role?"bg-primary text-primary-foreground":"bg-muted"),children:(0,t.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:e.content})}),"user"===e.role&&(0,t.jsx)(m.eu,{children:(0,t.jsx)(m.q5,{children:(0,t.jsx)(f,{})})})]},r)),C&&(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(m.eu,{children:(0,t.jsx)(m.q5,{children:(0,t.jsx)(u,{})})}),(0,t.jsx)("div",{className:"bg-muted p-3 rounded-lg",children:(0,t.jsx)(p.A,{className:"h-5 w-5 animate-spin"})})]})]})}),(0,t.jsxs)("form",{onSubmit:I,className:"flex gap-2 border-t pt-4",children:[(0,t.jsx)(i.p,{value:k,onChange:e=>A(e.target.value),placeholder:"Ask about supplements...",disabled:C}),(0,t.jsx)(n.$,{type:"submit",size:"icon",disabled:C||!k.trim(),children:(0,t.jsx)(h.A,{className:"h-4 w-4"})})]})]})]})}}}]);